# 日期更新功能说明

## 功能描述

当Knowledge Base Metadata中的"resources"数组包含严格的yyyy-MM-dd格式日期（如"2025-07-24"），且该日期为合法日期，并且此次操作为更新记录时，系统将自动将数据库中已有的created_at值的日期部分替换为该日期，同时保持时间部分不变。

## 使用示例

### 示例1：包含日期的resources数组

```
<<<<.<<<<.<<<<
{
  "echoToken": "EXAMPLE-TOKEN-123",
  "summary": "这是一个示例记录",
  "tags": ["example", "test"],
  "resources": ["file.txt", "2025-07-24", "other-resource"]
}
>>>>.>>>>.>>>>

这里是记录的内容...

----------
```

在这个例子中：
- 如果记录已存在，系统会检测到resources数组中的"2025-07-24"
- 将现有记录的created_at日期部分更新为2025-07-24
- 保持原有的时间部分不变

### 示例2：不包含日期的resources数组

```
<<<<.<<<<.<<<<
{
  "echoToken": "EXAMPLE-TOKEN-456",
  "summary": "另一个示例记录",
  "tags": ["example"],
  "resources": ["file.txt", "document.pdf"]
}
>>>>.>>>>.>>>>

这里是记录的内容...

----------
```

在这个例子中：
- resources数组中没有yyyy-MM-dd格式的日期
- created_at字段保持不变

## 日期格式要求

- **严格格式**：必须是yyyy-MM-dd格式（如2025-07-24）
- **合法日期**：必须是真实存在的日期（如2025-02-29是无效的）
- **完整格式**：月份和日期必须是两位数（如2025-7-24是无效的）

## 功能特点

1. **仅在更新时生效**：只有当记录已存在时才会更新日期
2. **保持时间精度**：只替换日期部分，时间部分（时、分、秒、毫秒）保持不变
3. **保持时区信息**：如果原始时间戳包含时区信息，新时间戳也会保持相同的时区
4. **多日期处理**：如果resources数组中包含多个日期，使用第一个有效日期
5. **日志记录**：系统会记录日期更新操作的详细信息

## 日志示例

当日期更新功能触发时，您会在日志中看到类似以下的信息：

```
2025-07-24 14:01:34,307 - INFO - 更新记录 EXAMPLE-TOKEN-123 的created_at日期部分为: 2025-07-24
```

## 注意事项

1. 此功能仅在更新现有记录时生效，新建记录时不会使用resources中的日期
2. 日期格式必须严格遵循yyyy-MM-dd格式
3. 系统会验证日期的有效性，无效日期将被忽略
4. 如果resources数组中没有有效日期，created_at字段将保持不变